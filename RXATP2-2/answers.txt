TP2 LAN
Remy DEBUE

1 Commutation (MAC => Port)
-------------
Switch(config)#no spanning-tree vlan 1 (desactive le protocole spanningtree)

1) 
	show mac-address-table (affiche la table de commutation)
	Le ping continue de passer quand on change de port
	L'adresse n'est plus dans la table de routage mais le ping reussit quand même

2) 

	3	1.855759000	10.1.2.3	10.1.2.95	ICMP	98	Echo (ping) request  id=0x6d36, seq=1/256, ttl=64 (no response found!)
	4	1.855985000	10.1.2.95	10.1.2.3	ICMP	98	Echo (ping) reply    id=0x6d36, seq=1/256, ttl=64 (request in 3)

	arp -s <nomhote> <hw_addr> (configure manuellement une adresse)
	Le ping ne répond même pas et lors de la capture de trame on ne reçois pas de retour sauf de temps en temps un message du protocole LOOP du routeur
	Le routeur agit comme un hub et renvoie le message à tous.

3)
	Configuration de la durée de retention : 
	Syntax
	#(config): mac-address-table aging-time <seconds>
	Celui qui possède la table va lancer un ping en diffusant sur tous les ports pour récupérer les adresses de tout le monde pour ensuite re-remplir sa table de routage.
	Ce phénomène ne se reproduit pas car les adresses continuent d'être utilisées pendant l'interval de dix secondes.
	Si on définit un intervalle trop court, la machine qui voulait envoyer un message sera diffusé sur tous les ports.
	Si on définit un intervalle trop long on aurait une table beaucoup trop grandes, avec des adresses qui ne sont plus utilisées et qui prendrait de la place pour rien.

4 et 5)
	Une même adresse MAC ne peut pas avoir plusieurs ports mais l'inverse si !
	On considère dans ce cas que la machine a changée de port

Tip : sudo ifconfig eth<i> @IP netmask 255.255.255.0

2 Sécurisation des ports
------------------------
mac-address-table <port security> (<switchport port-security>)

/!\
N'importe qui peut envoyer des trames sur un switch avec @MAC source qui va changer à chaque fois,
L'attaquant peut spammer le switch (avec une @MAC fictive). Le switch va essayer de remplir sa table, qui va saturer. Les nouvelles trames qui vont arriver ne seront plus associées à un port car la table est pleine. Le message sera donc envoyé sur tous les ports (On pourra donc voir tout ce qu'il y aura sur le réseau).
/!\

- Solution :
Port security

- Fonctionnement :
Machine une fois branchée à un port ne pourra pas essayer un autre port (mode sticky).
On peut limiter le nombre d'@MAC associées à un port. (résout l'attaque)

Ne résoud pas la copie de l'adresse MAC 
=> 802.1x (identification par certificat)

1)
show mac-address-table 
@MAC en Dynamic
configure terminal
interface FastEthernet 0/port
port security max-mac-count 2

- Les deux premières machines arrivent à se connecter, on peut les pinguer.
La troisième machine ne fonctionne pas. (les deux premières adresses ont réservés chacune le port security)

2)

3)

4)

5)

3 Boucles de commutation
------------------------
1)
Connexion de deux switchs entre eux avec un câble croisé
Ensuite il faut mettre le mode no spanning tree sur minicom
Le ping s'envoie en boucle à cause de l'envoi broadcast
2)
On refait le : arp -s <nomhote> <hw_addr> (configure manuellement une adresse)
Lorsqu'on ajoute l'adresse fictive on remarque tout de même une boucle..
Peut être que les switchs essayent de chercher à l'infini entre eux cette @MAC ?

3)
On peut afficher le nombre de (paquets/s) avec Statistics > Summary sur Wireshark
Si on applique le filtre de storm control  (port storm-control broadcast threshold rising <nb> falling <nb2> cela ne suffit pas, il faut en bloquer au moins deux sur les 4 pour que cela réussise.

stormcontrol avec forwarding : 
Désactiver le storm control : no storm-control

4 Bridge Linux
--------------
